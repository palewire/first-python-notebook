

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Chapter 7: Hello filters &mdash; First Python Notebook 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter 8: Hello merge" href="../merge/index.html" />
    <link rel="prev" title="Chapter 6: Hello columns" href="../value_counts/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> First Python Notebook
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../prerequisites/index.html">Prologue: Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipenv/index.html">Chapter 1: Hello pipenv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebook/index.html">Chapter 2: Hello notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pandas/index.html">Chapter 3: Hello pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../money/index.html">Chapter 4: Hello money in politics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataframe/index.html">Chapter 5: Hello data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../value_counts/index.html">Chapter 6: Hello columns</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Chapter 7: Hello filters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#filtering-a-dataframe">Filtering a DataFrame</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../merge/index.html">Chapter 8: Hello merge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../totals/index.html">Chapter 9: Hello totals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sort_values/index.html">Chapter 10: Hello sorting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../groupby/index.html">Chapter 11: Hello groupby</a></li>
<li class="toctree-l1"><a class="reference internal" href="../charts/index.html">Chapter 12: Hello charts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About the author</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">First Python Notebook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          









<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Home</a> &raquo;</li>
        
      
      <li>Chapter 7: Hello filters</li>
      
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="chapter-7-hello-filters">
<h1>Chapter 7: Hello filters<a class="headerlink" href="#chapter-7-hello-filters" title="Permalink to this headline">¶</a></h1>
<p>Until November 2016, the use and sale of marijuana for recreational purposes was illegal in California. That changed when voters approved Proposition 64, which asked if the practice ought to be legalized.</p>
<p>A yes vote supported legalization. A no vote opposed it. <a class="reference external" href="http://elections.cdn.sos.ca.gov/sov/2016-general/sov/65-ballot-measures-formatted.pdf">In the final tally</a>, 57% of voters said yes.</p>
<p>Our next mission is to use the DataFrames containing campaign committees and contributors to figure out the biggest donors both for and against the measure.</p>
<p>To do that, the first thing we need to do is isolate the fundraising committees active on Proposition 64, which are now buried among of the list of more than 100 groups active last November.</p>
<div class="section" id="filtering-a-dataframe">
<h2>Filtering a DataFrame<a class="headerlink" href="#filtering-a-dataframe" title="Permalink to this headline">¶</a></h2>
<p>The most common way to filter a DataFrame is to pass an expression as an “index” that can be used to decide which records should be kept and which discarded.</p>
<p>You write the expression by combining a column on your DataFrame with an <a class="reference external" href="https://en.wikipedia.org/wiki/Operator_(computer_programming)">“operator”</a> like <code class="docutils literal notranslate"><span class="pre">==</span></code> or <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and a value to compare the column against.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are familiar with writing <a class="reference external" href="https://en.wikipedia.org/wiki/SQL">SQL</a> to manipulate databases, pandas’ filtering system is somewhat similar to a <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> query. The <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/comparison/comparison_with_sql.html#where">official pandas documentation</a> offers direct translations between the two.</p>
</div>
<p>In our case, the column we want to filter against is <code class="docutils literal notranslate"><span class="pre">prop_name</span></code>. We only want to keep those records where the value there matches the full name of Proposition 64.</p>
<p>Where do we get that? Our friend <a class="reference internal" href="../value_counts/index.html"><span class="doc">value counts</span></a>.</p>
<p>Running the command we learned before to list and count all of the proposition names will spit out the full name of all 17 measures.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">committee_list</span><span class="o">.</span><span class="n">prop_name</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
<p>From that result we can copy the full name of the proposition and place it between quotation marks in a variable in a new cell. This will allow us to reuse it later.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_prop</span> <span class="o">=</span> <span class="s1">&#39;PROPOSITION 064- MARIJUANA LEGALIZATION. INITIATIVE STATUTE.&#39;</span>
</pre></div>
</div>
<p>Now, in the next cell we will form the filter expression expected by pandas.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">committee_list</span><span class="o">.</span><span class="n">prop_name</span> <span class="o">==</span> <span class="n">my_prop</span>
</pre></div>
</div>
<p>That expression is then placed between two flat brackets following the variable we want to filter. Place the following code in the next open cell in your notebook.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">committee_list</span><span class="p">[</span><span class="n">committee_list</span><span class="o">.</span><span class="n">prop_name</span> <span class="o">==</span> <span class="n">my_prop</span><span class="p">]</span>
</pre></div>
</div>
<p>Run it and it outputs the filtered dataset, just those committees active on Proposition 64.</p>
<p>Now we should save the results of that filter into new variable separate from the full list we imported from the CSV file.</p>
<p>Since it includes only the committees for one proposition lets call it the singular prop.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_committees</span> <span class="o">=</span> <span class="n">committee_list</span><span class="p">[</span><span class="n">committee_list</span><span class="o">.</span><span class="n">prop_name</span> <span class="o">==</span> <span class="n">my_prop</span><span class="p">]</span>
</pre></div>
</div>
<p>To check our work find out how many committees are left after the filter, let’s run the DataFrame inspection commands we learned earlier.</p>
<p>First head.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_committees</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Then info.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_committees</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../merge/index.html" class="btn btn-neutral float-right" title="Chapter 8: Hello merge" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../value_counts/index.html" class="btn btn-neutral float-left" title="Chapter 6: Hello columns" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Ben Welsh and the California Civic Data Coalition

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>